@page
@using Ticket_Hive.Data.Models;
@model Ticket_Hive.UI.Pages.Member.BookingPageModel
@{
	bool showSearchResults = !string.IsNullOrEmpty(Model.search);
}
<style>
	body {
		background-color: #fbe89c;
		margin: 10px;
	}

	a:hover {
		cursor: pointer;
	}


	a {
		text-decoration: none;
		color: #305076;
	}

	.EventInfo {
		height: 40px;
		padding: 0 30px;
		font-size: 30px;
		text-align: center;
	}

	.MarginFix {
		margin-bottom: 25px;
		margin-top: 25px;
	}

	.SortBar span {
		display: inline-block;
		width: 14%;
		text-align: center;
	}

	.EventInfo .name {
		width: 14%;
		display: inline-block;
		text-align: center;
	}

	.EventInfo .type {
		width: 14%;
		display: inline-block;
		text-align: center;
	}

	.EventInfo .location {
		width: 14%;
		display: inline-block;
		text-align: center;
	}

	.EventInfo .price {
		width: 14%;
		display: inline-block;
		text-align: center;
	}

	.EventInfo .date {
		width: 14%;
		display: inline-block;
		text-align: center;
	}

	.events-container {
		display: flex;
		flex-wrap: wrap;
		max-height: calc(100vh - 250px); 
		overflow-y: auto;
	}

	.event-card {
    background-color: #fff;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
    transition: 0.3s;
    border-radius: 5px;
    background-image: url('${event.image}');
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center center;
}

.event-card:hover {
			box-shadow: 0 8px 16px 0 #305076;
}

.event-card h2.event-name {
    font-size: 24px;
    font-weight: bold;
    margin-top: 1em;
    margin-bottom: 0.5em;
    color: #fff;
    text-shadow: 1px 1px #000;
}

.event-card div {
    margin-top: 0.5em;
    color: #fff;
    text-shadow: 1px 1px #000;
}

.event-card label {
    font-weight: bold;
}

.event-card p {
    margin: 0;
}

.events-container {
    display: flex;
    flex-wrap: wrap;
}

.events-container > * {
    flex-basis: calc(33.33% - 2em);
    margin: 1em;
}

#sort-button, #sortprice-button {
  display: inline-block;
  margin-left: 10px; 
  background-color: #305076;
  color: #fff;
  border: none;
  padding: 10px;
  font-size: 16px;
  cursor: pointer;
}



	.searchbar-size {
		width: 500px;
		height: 50px;
		text-size-adjust: auto;
		padding: 0 10px;
		font-size: 35px;	}

	.button-container {
		display: flex;
		gap: 10px;
		margin-top: 10px;
	}

		.button-container button {
			background-color: #305076;
			color: #fff;
			border: none;
			border-radius: 5px;
			padding: 10px 20px;
			font-size: 16px;
			cursor: pointer;
		}

</style>


<input class="searchbar-size" id="search-bar" type="text">
<div class="button-container">
	<button id="sort-button">Sort by Name</button>
	<button id="sortprice-button">Sort by Price</button>
</div>
<div id="output"></div>	


<script>
	// Variables
	let allEvents;

	// Selectors
	let searchInput = document.querySelector("#search-bar");
	let sortButton = document.querySelector("#sort-button");
	let sortPriceButton = document.querySelector("#sortprice-button");
	let sortDateButton = document.querySelector("#sortdate-button")

	let searchParams = new URLSearchParams(window.location.search);
	let searchTerm = searchParams.get("search");


	// Event listeners
	searchBar.addEventListener("input", filterEvents)

	sortButton.addEventListener("click", sortEvents);
	sortPriceButton.addEventListener("click", sortPriceEvents);

	searchInput.value = searchTerm;


	// Function calls
	getEvents();
	filterEvents({ target: searchInput });
	// Functions

	// Function to sort events by name
	function sortEvents() {
		allEvents.sort((a, b) => a.name.localeCompare(b.name));
		displayData(allEvents);
	}

	// Function to sort events by price
	function sortPriceEvents() {
		allEvents.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
		displayData(allEvents);
	}

	/// <summary>
	/// Function to filter events based on search term
	/// </summary>	
	
	function filterEvents(e) {
		let searchTerm = e.target.value.toLowerCase();

		let filteredEvents = allEvents.filter(e => {
			if (e.name.toLowerCase().includes(searchTerm) || e.location.toLowerCase().includes(searchTerm) || e.eventType.toLowerCase().includes(searchTerm)) {
				return true;
			}
		})
		displayData(filteredEvents);
	}

	// Function to get all event data from API
	function getEvents(search) {
		fetch("/api/events").then(res => res.json()).then(data => {
			allEvents = data;
			displayData(allEvents);
		});
	}

	/// <summary>
	/// Function to display event data on the page
	/// </summary>
	function displayData(events) {


		let output = '<h2>Events</h2>';
		output += '<div class="events-container">';
		events.forEach(function (event) {
			let eventDate = event.dateTime.substring(0, 16).replace("T", " ");

			/// <summary>
			/// Create a card for the events with its data and image as background
			/// </summary>
			output += `
							<div class="event-card p-3 m-2 border border-2 border-dark" style="background-image: url('${event.image}')">	
									<h2 class="mb-2 event-name" data-id="${event.id}">${event.name}</h2>
								<div>
									<label class="fw-bold">Type:</label>
									<p class="">${event.eventType}</p>
								</div>
								<div>
									<label class="fw-bold">Location:</label>
									<p class="">${event.location}</p>
								</div>
								<div>
									<label class="fw-bold">Price:</label>
									<p class="">${event.price}</p>
								</div>
								<div>
									<label class="fw-bold">Date:</label>
									<p class="">${eventDate}</p>
								</div>
							</div>`

		});

		output += '</div>';

		document.getElementById('output').innerHTML = output;

		/// <summary>
		//Makes it possible to click the events name to go that events info page
		/// </summary>
		let eventDivs = document.querySelectorAll(".event-name");
		eventDivs.forEach(function (div) {
			div.addEventListener("click", function () {
				let eventId = this.getAttribute("data-id");
				window.location.href = "/member/evenemang?id=" + eventId;
			});
		});
	}
</script>











